import{j as t,i as j,r as l,Q as C,e as V,k as H}from"./index-b6de0c13.js";import{T,B as y,P as K,O as S,U as b,X as w,S as X,Q as $}from"./index.esm-e518aae7.js";import{L as N,P as Q}from"./Pagination-daa67818.js";import{M,c as E,D as _}from"./toast-f82b97ee.js";function q({width:n=18,height:r=18}){return t.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 576 512",height:n,width:r,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"})})}const F=n=>j.post("/links",n),W=(n,r,o)=>j.post("/links/query",{limit:n,offset:r,crawType:o}),G=n=>j.delete(`/links/${n}`),J=n=>j.put("/links",n),Y=({setIsModalOpen:n,isModalOpen:r,isReload:o,setIsReload:p,crawType:i})=>{const[u,c]=l.useState(""),d=async()=>{if(u.length===0){C.error("Nội dung không được trống!");return}const h={links:u.split(`
`).map(a=>a.trim()).filter(a=>a.length>0).map(a=>{const g=a.split("|");return{url:g[0],name:g[1],delayTime:1}}),status:N.Started,hideCmt:!1,thread:1,tablePageId:null,crawType:i};try{const a=await F(h);c(""),n(!1),p(!o),C(a.data.message)}catch(a){E(a)}},k=()=>d();return t.jsx(M,{title:"Add link",closable:{"aria-label":"Custom Close Button"},open:r,onOk:()=>k(),onCancel:()=>n(!1),children:t.jsx(T,{onChange:m=>{c(m.target.value)},rows:4})})},Z=({setIsModalOpen:n,isModalOpen:r,isReload:o,setIsReload:p,link:i})=>{const u=async()=>{if(i.linkUrl.length===0){C.error("Nội dung không được trống!");return}try{n(!1),p(!o),C("Update thành công!"),await J(i)}catch(d){E(d)}},c=()=>u();return t.jsx(M,{title:"Edit link",closable:{"aria-label":"Custom Close Button"},open:r,onOk:()=>c(),onCancel:()=>n(!1),children:t.jsx(T,{"aria-label":"Url",defaultValue:i.linkUrl,onChange:d=>{i.linkUrl=d.target.value},rows:4})})};function at({crawType:n}){const{optionsReactTableDefault:r}=V(),[o,p]=l.useState(!1),[i,u]=l.useState(!1),[c,d]=l.useState(null),[k,m]=l.useState(null),[h,a]=l.useState(!1),[g,O]=l.useState(0),[x,U]=l.useState(50),[z,A]=l.useState(0),L=async()=>{const e=await W(x,x*(g?g-1:0),n);d(e.data.data),A(e.data.totalCount)};l.useEffect(()=>{(async()=>await L())()},[h,g,x]),l.useEffect(()=>{const e=setInterval(()=>{L()},1e4);return()=>clearTimeout(e)},[]);const B=e=>{window.open(e,"_blank")},v=l.useMemo(()=>[{header:"Url",accessorKey:"linkUrl",size:100,Cell:e=>{const s=e.row.original.linkUrl;return s&&s.length>100?`${(s??"").slice(0,100)}...`:s??"Trống"}},{header:"Content",accessorKey:"content",size:600,Cell:e=>{const s=e.row.original.content;return s&&s.length>100?`${(s??"").slice(0,100)}...`:s??"Trống"}},{header:"Status",accessorKey:"type",size:200,muiTableHeadCellProps:{sx:{p:0,m:0,width:"50px"}},muiTableBodyCellProps:{sx:{p:0,m:0,width:"50px"}},Cell:e=>{const s=e.row.original.type,f=D(s);return t.jsx(t.Fragment,{children:t.jsx(y,{type:"primary",children:f})})}}],[]),D=e=>{let s="Đang chờ";return e==="die"?"Die":e==="private"||e==="public"?"Live":s},P=K({columns:v,data:c??[],...r,enableBottomToolbar:!0,initialState:{...r.initialState},state:{isLoading:!c},renderRowActions:({row:e})=>{const s=e.original.linkUrl;return t.jsxs(S,{sx:{display:"flex",gap:"1rem"},children:[t.jsx(y,{type:"primary",onClick:()=>B(s),children:"Xem"}),t.jsx(b,{title:"Edit",children:t.jsx(w,{onClick:()=>{u(!0);const f=(c??[]).find(I=>I.id==e.original.id);f&&m(f)},children:t.jsx(q,{})})}),t.jsx(b,{title:"Delete",children:t.jsx(w,{color:"error",onClick:()=>{R(e.original.id)},children:t.jsx(_,{})})})]})},renderTopToolbarCustomActions:()=>t.jsx(y,{type:"primary",onClick:()=>{p(!0)},children:"Add"}),renderBottomToolbar:()=>t.jsx(S,{sx:{p:1,display:"flex",justifyContent:"flex-end"},children:t.jsx(Q,{pageSize:x,setPage:O,setPageSize:U,totalCount:z,pageSizeOptions:["50","100","200"],setData:d})})}),R=async e=>{H("Xóa thành công!"),await G(e),a(!h)};return t.jsxs(X,{gap:"1rem",children:[t.jsx($,{table:P}),o&&t.jsx(Y,{setIsModalOpen:p,isModalOpen:o,isReload:h,setIsReload:a,crawType:n}),i&&k&&t.jsx(Z,{setIsModalOpen:u,isModalOpen:i,isReload:h,setIsReload:a,link:k})]})}export{at as L};
