import{j as e,i as j,r as l,Q as C,e as V,k as H}from"./index-4bbbc2bd.js";import{T as w,B as y,P as X,O as L,U as S,X as T,S as $,Q as F}from"./index.esm-cfadb478.js";import{M as E,c as M,D as N}from"./toast-1d43234b.js";import{P as Q}from"./Pagination-ce9985cd.js";function _({width:t=18,height:r=18}){return e.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 576 512",height:t,width:r,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"})})}var q=(t=>(t.FACEBOOK="facebook",t.TIKTOK="tiktok",t))(q||{}),O=(t=>(t.Pending="pending",t.Started="started",t))(O||{});const W=t=>j.post("/links",t),G=(t,r,i)=>j.post("/links/query",{limit:t,offset:r,crawType:i}),J=t=>j.delete(`/links/${t}`),Y=t=>j.put("/links",t),Z=({setIsModalOpen:t,isModalOpen:r,isReload:i,setIsReload:p,crawType:o})=>{const[u,c]=l.useState(""),d=async()=>{if(u.length===0){C.error("Nội dung không được trống!");return}const h={links:u.split(`
`).map(a=>a.trim()).filter(a=>a.length>0).map(a=>{const g=a.split("|");return{url:g[0],name:g[1],delayTime:1}}),status:O.Started,hideCmt:!1,thread:1,tablePageId:null,crawType:o};try{const a=await W(h);c(""),t(!1),p(!i),C(a.data.message)}catch(a){M(a)}},k=()=>d();return e.jsx(E,{title:"Add link",closable:{"aria-label":"Custom Close Button"},open:r,onOk:()=>k(),onCancel:()=>t(!1),children:e.jsx(w,{onChange:m=>{c(m.target.value)},rows:4})})},tt=({setIsModalOpen:t,isModalOpen:r,isReload:i,setIsReload:p,link:o})=>{const u=async()=>{if(o.linkUrl.length===0){C.error("Nội dung không được trống!");return}try{t(!1),p(!i),C("Update thành công!"),await Y(o)}catch(d){M(d)}},c=()=>u();return e.jsx(E,{title:"Edit link",closable:{"aria-label":"Custom Close Button"},open:r,onOk:()=>c(),onCancel:()=>t(!1),children:e.jsx(w,{"aria-label":"Url",defaultValue:o.linkUrl,onChange:d=>{o.linkUrl=d.target.value},rows:4})})};function lt({crawType:t}){const{optionsReactTableDefault:r}=V(),[i,p]=l.useState(!1),[o,u]=l.useState(!1),[c,d]=l.useState(null),[k,m]=l.useState(null),[h,a]=l.useState(!1),[g,v]=l.useState(0),[x,A]=l.useState(50),[B,U]=l.useState(0),b=async()=>{const n=await G(x,x*(g?g-1:0),t);d(n.data.data),U(n.data.totalCount)};l.useEffect(()=>{(async()=>await b())()},[h,g,x]),l.useEffect(()=>{const n=setInterval(()=>{b()},1e4);return()=>clearTimeout(n)},[]);const z=n=>{window.open(n,"_blank")},P=l.useMemo(()=>[{header:"Url",accessorKey:"linkUrl",size:100,Cell:n=>{const s=n.row.original.linkUrl;return s&&s.length>100?`${(s??"").slice(0,100)}...`:s??"Trống"}},{header:"Content",accessorKey:"content",size:600,Cell:n=>{const s=n.row.original.content;return s&&s.length>100?`${(s??"").slice(0,100)}...`:s??"Trống"}},{header:"Status",accessorKey:"type",size:200,muiTableHeadCellProps:{sx:{p:0,m:0,width:"50px"}},muiTableBodyCellProps:{sx:{p:0,m:0,width:"50px"}},Cell:n=>{const s=n.row.original.type,f=D(s);return e.jsx(e.Fragment,{children:e.jsx(y,{type:"primary",children:f})})}}],[]),D=n=>{let s="Đang chờ";return n==="die"?"Die":n==="private"||n==="public"?"Live":s},I=X({columns:P,data:c??[],...r,enableBottomToolbar:!0,initialState:{...r.initialState},state:{isLoading:!c},renderRowActions:({row:n})=>{const s=n.original.linkUrl;return e.jsxs(L,{sx:{display:"flex",gap:"1rem"},children:[e.jsx(y,{type:"primary",onClick:()=>z(s),children:"Xem"}),e.jsx(S,{title:"Edit",children:e.jsx(T,{onClick:()=>{u(!0);const f=(c??[]).find(K=>K.id==n.original.id);f&&m(f)},children:e.jsx(_,{})})}),e.jsx(S,{title:"Delete",children:e.jsx(T,{color:"error",onClick:()=>{R(n.original.id)},children:e.jsx(N,{})})})]})},renderTopToolbarCustomActions:()=>e.jsx(y,{type:"primary",onClick:()=>{p(!0)},children:"Add"}),renderBottomToolbar:()=>e.jsx(L,{sx:{p:1,display:"flex",justifyContent:"flex-end"},children:e.jsx(Q,{pageSize:x,setPage:v,setPageSize:A,totalCount:B,pageSizeOptions:["50","100","200"],setData:d})})}),R=async n=>{H("Xóa thành công!"),await J(n),a(!h)};return e.jsxs($,{gap:"1rem",children:[e.jsx(F,{table:I}),i&&e.jsx(Z,{setIsModalOpen:p,isModalOpen:i,isReload:h,setIsReload:a,crawType:t}),o&&k&&e.jsx(tt,{setIsModalOpen:u,isModalOpen:o,isReload:h,setIsReload:a,link:k})]})}export{q as C,lt as L};
